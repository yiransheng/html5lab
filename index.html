<!DOCTYPE html>

<html>
  <head>
    <title>Yiran's Html5 Lab</title>
    <link rel="stylesheet" type="text/css" href="assets/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/style.css">
    <link rel="stylesheet" type="text/css" href="assets/prettify.css">
    <script type="text/javascript" src="assets/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="assets/jquery.address.min.js"></script>
    <script type="text/javascript" src="js/sheng.all.min.js"></script>
    <script type="text/javascript" src="js/ui.js"></script>
    <script type="text/javascript" src="assets/strftime.js"></script>
    <script type="text/javascript" src="assets/prettify.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
	var url_strings = window.location.href.split("#/"), 
	    url_prefix = "", appsTab, appTab, stage,  
	    app = url_strings.length>1 ? url_strings[url_strings.length-1] : "", 
	    app_src = url_prefix + app, 
	    Config = null, AppList = null, main, appView;

	if (app_src.match(/[^//]+$/g)) {
	    app_src += "/"  
	};


	listHandler = function() {
	    $("#browse").removeClass("hide");
	    $("#container").addClass("hide");
	    // tab view
	    window.appsTab = window.appsTab || Sheng.create(Tab, {
		el : "#browse"
	    }).init();

	    if (window.appListView) return;
	    window.appListView = Sheng.create(AppListView).init(AppList);
	    $("#apps-new").html(appListView.render());
	    $("#apps-featured").html(appListView.renderByTag("featured"));
	    $("#apps-bytag .tag-cloud").html(appListView.tagCloud());


	    $("#browse").find("span a").bind("click", function(e){
		e.preventDefault();
		var tag = $(this).attr("name");
		$('#apps-bytag .list').empty().html(appListView.renderByTag(tag)).find("span a")
		    .bind("click", arguments.callee);
		window.appsTab.moveTo({ target: '#browse span[name="2"]' });
	    });

	    $("#browse").find('a[name="title"]').address();

	};
	appHandler = function() {

	    $("#browse").addClass("hide");
	    $("#container").removeClass("hide");
            $.getJSON(app_src+"config.json", function(res){
	        if (res.config) Sheng.extend(Config, res.config);
	        $('title').text(res.name || app);
		$("#info-intro p").html(res.description);
		main(Config);
	    });

	    // tab view
	    window.appTab = window.appTab || Sheng.create(Tab, {
		el: "#atab"
	    }).init();
	};


        // loading content and readying the everything 
	main = function(config) { 
            stage.trigger("change", app_src, config);
	    $.get(app_src+config.html, function(data){
	       $('#info-html').find("pre:first").text(data);   
	    }, "text");
	    $.get(app_src+config.script, function(data){
		$('#info-js').find("pre:first").text(data);   
	    }, "text");
	    $("#info-css").get(app_src+config.css, function(data){
	       $('#info-css').find("pre:first").text(data);   
	    }, "text");

	    $("pre").ajaxSuccess(function() {
	        prettyPrint();
	    });
	};

	stage = window.stage = stage || Sheng.create(Stage, {
	    el: "#stage", 
	    src: app_src
	});

	Sheng.extend(window.stage, Sheng.events);
	stage.bind("change", function(app_src, config){
	    $(stage.el).empty();
	    stage.src = app_src;
	    stage.init(config || {});
	});

	$.address.change(function(e){
	    var route = e.value.replace(/^\/+|\/+$/g, "");
	    if (route){
	        app_src = route+"/";
	        appHandler();
	    } else {
	        listHandler();
	    }
	});

	$.getJSON("index.json", function(res){
	    Config = res.DefaultConfig;
	    AppList = res.registered.slice(0, 49);
            // fail loading an app
	    if (!app){
	        listHandler();
	    } else { 
	        appHandler();
	    }
	});


    });
    </script>

    <!--[if gte IE 9]>
    <style>
	.grad-head, header,.grad-bar{
	    filter: none;
	}
	</style>
    <![endif]-->
  </head>
  <body>
      <header class="shadow">
      <div class="wrapper">
	  <h1>Yiran's Html5 Experiments</h1>
	  <span></span><div class="nav"><a href="http://yiransheng.github.com/html5lab/">Home</a></div>
	  <span></span><div class="nav"><a href="http://www.yiransheng.com">Blog</a></div>
	  <span></span><div class="nav"><a href="http://github.com/yiransheng">Github</a></div>
	  <span></span><div class="nav"><a href="http://www.yiransheng.com/about">About me</a></div>
	  <span></span>
      </div>
      </header>
      <div id="browse" class="hide shadow round-corner-five">
	  <div class="sheng-ui-tabhead grad-head"> </div>
	  <div id="template-applist" class="hide"> 
	     <li>
	       <a href="#sample" name="title">Sample app title.</a>
	       Updated: <span name="date">2012-04-06 12:48pm</span>
	       Tags: <span name="tags">sample, test</span>
	     </li> 
	  </div>
	  <div class="sheng-ui-tab" name="New" id="apps-new">
	       
	       </div>
	  <div class="sheng-ui-tab" name="Featured" id="apps-featured">
	       
	       </div>
	  <div class="sheng-ui-tab" name="By Tag" id="apps-bytag">
	       <span class="tag-cloud"> </span>
	       <hr>
	       <div class="list"> </div>

	       </div>

      </div>
      <div id="container">
	  <div id="atab" class="info-tab round-corner-five shadow">
	      <div class="sheng-ui-tabhead grad-head"> </div>
	      <div class="sheng-ui-tab" name="Description">
		  <div id="info-intro"><p> </p></div>
		  </div>
	      <div class="sheng-ui-tab" name="Html">
		  <div id="info-html"><pre class="prettyprint"> </pre></div>
		  </div>
	      <div class="sheng-ui-tab" name="JavaScript">
		  <div id="info-js"><pre class="prettyprint"> </pre></div>
		  </div>
	      <div class="sheng-ui-tab" name="CSS">
		  <div id="info-css"><pre class="prettyprint"> </pre></div>
		  </div>
	  </div>
	  <div id="stage" class="demo-stage round-corner-five shadow"> </div>
      </div>
      <div id="footer" class="shadow-inset">Site owned by <a href="http://www.yiransheng.com">Yiran Sheng</a>, powered by <a href="http://pages.github.com/">Github Pages</a>. App routing enabled by <a href="https://github.com/asual/jquery-address">jQuery.address</a></div>
  </body>
</html>
      </div>
  </body>
</html>
      </div>
  </body>
</html>
